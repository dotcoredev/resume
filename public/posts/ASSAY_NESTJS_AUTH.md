# –≠—Å—Å–µ: –ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –≤ NestJS —Å Passport, JWT –∏ Cookies

–ü—Ä–∏–≤–µ—Ç! –≠—Ç–æ —Ç–≤–æ–π –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –≥–∞–π–¥ –≤ –º–∏—Ä –±–µ–∑–æ–ø–∞—Å–Ω–æ–π –∏ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –≤ NestJS. –ü—Ä–æ—á–∏—Ç–∞–≤ —ç—Ç–æ —ç—Å—Å–µ, —Ç—ã –Ω–µ –ø—Ä–æ—Å—Ç–æ –Ω–∞—É—á–∏—à—å—Å—è –∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥, –∞ —Å—Ç–∞–Ω–µ—à—å —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–º, –∫–æ—Ç–æ—Ä—ã–π **–ø–æ–Ω–∏–º–∞–µ—Ç, —á—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –Ω–∞ –∫–∞–∂–¥–æ–π —Å—Ç—Ä–æ—á–∫–µ**. –ú—ã –ø–æ—Å—Ç—Ä–æ–∏–º –Ω–∞–¥–µ–∂–Ω—É—é —Å–∏—Å—Ç–µ–º—É, –∏—Å–ø–æ–ª—å–∑—É—è –º–æ—â–Ω—É—é —Å–≤—è–∑–∫—É: **Passport** –¥–ª—è —Å—Ç—Ä–∞—Ç–µ–≥–∏–π, **JWT** –¥–ª—è —Ç–æ–∫–µ–Ω–æ–≤ –∏ **HttpOnly Cookies** –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è.

–ü–æ–µ—Ö–∞–ª–∏! üöÄ

---

## üéØ **–ß–∞—Å—Ç—å 1: –§–∏–ª–æ—Å–æ—Ñ–∏—è –∏ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**

–ü—Ä–µ–∂–¥–µ —á–µ–º –ø–∏—Å–∞—Ç—å –∫–æ–¥, –¥–∞–≤–∞–π —Ä–∞–∑–±–µ—Ä–µ–º—Å—è –≤ "–ø–æ—á–µ–º—É" –∏ "–∫–∞–∫".

### **–ü–æ—á–µ–º—É –∏–º–µ–Ω–Ω–æ —ç—Ç–æ—Ç —Å—Ç–µ–∫?**

1.  **NestJS**: –ù–∞—à —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç. –≠—Ç–æ –ø—Ä–æ–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ –¥–ª—è Node.js, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –º–æ–¥—É–ª—å–Ω—É—é –∏ —Ö–æ—Ä–æ—à–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É. –ò–¥–µ–∞–ª—å–Ω–æ –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö —Å–∏—Å—Ç–µ–º.
2.  **Passport.js**: –®–≤–µ–π—Ü–∞—Ä—Å–∫–∏–π –Ω–æ–∂ –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –≤ Node.js. –ï–≥–æ –≥–ª–∞–≤–Ω–∞—è —Ñ–∏—à–∫–∞ ‚Äî **—Å—Ç—Ä–∞—Ç–µ–≥–∏–∏**. –í–º–µ—Å—Ç–æ —Ç–æ–≥–æ —á—Ç–æ–±—ã –ø–∏—Å–∞—Ç—å –ª–æ–≥–∏–∫—É –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞, –º—ã –æ–¥–∏–Ω —Ä–∞–∑ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º "—Å—Ç—Ä–∞—Ç–µ–≥–∏—é" (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∫–∞–∫ –¥–æ—Å—Ç–∞—Ç—å JWT –∏–∑ cookie), –∞ Passport –¥–µ–ª–∞–µ—Ç –≤—Å—é –≥—Ä—è–∑–Ω—É—é —Ä–∞–±–æ—Ç—É.
3.  **JWT (JSON Web Token)**: –≠—Ç–æ –Ω–∞—à "–ø—Ä–æ–ø—É—Å–∫" –∏–ª–∏ "–ø–∞—Å–ø–æ—Ä—Ç". –ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É—Å–ø–µ—à–Ω–æ –ª–æ–≥–∏–Ω–∏—Ç—Å—è, –º—ã –≤—ã–¥–∞–µ–º –µ–º—É JWT. –≠—Ç–æ –∫–æ–º–ø–∞–∫—Ç–Ω–∞—è, –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ç—Ä–æ–∫–∞, –∫–æ—Ç–æ—Ä–∞—è —Å–æ–¥–µ—Ä–∂–∏—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –µ–≥–æ ID –∏ —Ä–æ–ª—å). –ü—Ä–∏ –∫–∞–∂–¥–æ–º –ø–æ—Å–ª–µ–¥—É—é—â–µ–º –∑–∞–ø—Ä–æ—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–µ–¥—ä—è–≤–ª—è–µ—Ç —ç—Ç–æ—Ç —Ç–æ–∫–µ–Ω, –∏ –º—ã, –ø—Ä–æ–≤–µ—Ä–∏–≤ –µ–≥–æ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç—å, –ø–æ–Ω–∏–º–∞–µ–º, –∫—Ç–æ –ø–µ—Ä–µ–¥ –Ω–∞–º–∏. –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –Ω–∞–º —Å–æ–∑–¥–∞—Ç—å **stateless** (–±–µ–∑ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è) –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é, —á—Ç–æ –∏–¥–µ–∞–ª—å–Ω–æ –¥–ª—è –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è.
4.  **Cookies (—Å —Ñ–ª–∞–≥–æ–º `HttpOnly`)**: –≠—Ç–æ –Ω–∞—à "–∫–∞—Ä–º–∞–Ω" –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è JWT –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ –∫–ª–∏–µ–Ω—Ç–∞. –ü–æ—á–µ–º—É –Ω–µ `localStorage`? –ü–æ—Ç–æ–º—É —á—Ç–æ `localStorage` —É—è–∑–≤–∏–º –¥–ª—è XSS-–∞—Ç–∞–∫ (Cross-Site Scripting). –ó–ª–æ—É–º—ã—à–ª–µ–Ω–Ω–∏–∫ –º–æ–∂–µ—Ç –≤–Ω–µ–¥—Ä–∏—Ç—å —Å–∫—Ä–∏–ø—Ç –Ω–∞ –≤–∞—à—É —Å—Ç—Ä–∞–Ω–∏—Ü—É –∏ —É–∫—Ä–∞—Å—Ç—å —Ç–æ–∫–µ–Ω. `HttpOnly` cookie –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è JavaScript –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ, –µ–≥–æ –º–æ–∂–µ—Ç —á–∏—Ç–∞—Ç—å —Ç–æ–ª—å–∫–æ —Å–µ—Ä–≤–µ—Ä. –≠—Ç–æ **–∑–æ–ª–æ—Ç–æ–π —Å—Ç–∞–Ω–¥–∞—Ä—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏** –¥–ª—è –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π.

### **–ö–∞–∫ –≤—ã–≥–ª—è–¥–∏—Ç –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏?**

–í–æ—Ç –∫–∞–∫ –≤—Å–µ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å, –∫–æ–≥–¥–∞ –º—ã –∑–∞–∫–æ–Ω—á–∏–º:

```mermaid
sequenceDiagram
    participant Client as –ö–ª–∏–µ–Ω—Ç (–ë—Ä–∞—É–∑–µ—Ä)
    participant Server as –°–µ—Ä–≤–µ—Ä (NestJS)
    participant DB as –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

    Client->>+Server: POST /auth/login (–ª–æ–≥–∏–Ω, –ø–∞—Ä–æ–ª—å)
    Server->>+DB: –ù–∞–π—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ –ª–æ–≥–∏–Ω—É
    DB-->>-Server: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–π–¥–µ–Ω
    Server->>Server: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ö—ç—à –ø–∞—Ä–æ–ª—è
    alt –ü–∞—Ä–æ–ª—å –≤–µ—Ä–Ω—ã–π
        Server->>Server: –°–æ–∑–¥–∞—Ç—å JWT (—Å ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
        Server-->>-Client: –û—Ç–≤–µ—Ç 200 OK + Set-Cookie (httpOnly, JWT)
    else –ü–∞—Ä–æ–ª—å –Ω–µ–≤–µ—Ä–Ω—ã–π
        Server-->>-Client: –û—Ç–≤–µ—Ç 401 Unauthorized
    end

    Note over Client, Server: –¢–µ–ø–µ—Ä—å –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ –±—Ä–∞—É–∑–µ—Ä –±—É–¥–µ—Ç<br/>–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å cookie —Å JWT

    Client->>+Server: GET /profile (—Å cookie)
    Server->>Server: Passport.js (JwtStrategy) –∏–∑–≤–ª–µ–∫–∞–µ—Ç JWT –∏–∑ cookie
    Server->>Server: –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ–¥–ø–∏—Å—å JWT (–∏—Å–ø–æ–ª—å–∑—É—è —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á)
    alt –ü–æ–¥–ø–∏—Å—å –≤–∞–ª–∏–¥–Ω–∞
        Server->>Server: –ò–∑–≤–ª–µ–∫–∞–µ—Ç payload (ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è) –∏–∑ JWT
        Server->>+DB: –ù–∞–π—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ ID
        DB-->>-Server: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–π–¥–µ–Ω
        Server->>Server: –ü—Ä–∏–∫—Ä–µ–ø–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∫ –æ–±—ä–µ–∫—Ç—É –∑–∞–ø—Ä–æ—Å–∞ (req.user)
        Server-->>-Client: –û—Ç–≤–µ—Ç 200 OK (–¥–∞–Ω–Ω—ã–µ –ø—Ä–æ—Ñ–∏–ª—è)
    else –ü–æ–¥–ø–∏—Å—å –Ω–µ–≤–∞–ª–∏–¥–Ω–∞
        Server-->>-Client: –û—Ç–≤–µ—Ç 401 Unauthorized
    end
```

---

## üõ†Ô∏è **–ß–∞—Å—Ç—å 2: –ü–æ—à–∞–≥–æ–≤–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è**

–¢–µ–ø–µ—Ä—å, –∫–æ–≥–¥–∞ –º—ã –ø–æ–Ω–∏–º–∞–µ–º —Ç–µ–æ—Ä–∏—é, –ø–µ—Ä–µ–π–¥–µ–º –∫ –ø—Ä–∞–∫—Ç–∏–∫–µ.

### **–®–∞–≥ 1: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π**

–û—Ç–∫—Ä–æ–π —Ç–µ—Ä–º–∏–Ω–∞–ª –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞ –∏ –≤—ã–ø–æ–ª–Ω–∏ –∫–æ–º–∞–Ω–¥—É:

```bash
pnpm add @nestjs/passport passport passport-jwt @nestjs/jwt jsonwebtoken cookie-parser
pnpm add -D @types/passport-jwt @types/cookie-parser
```

*   `@nestjs/passport`, `passport`: –û—Å–Ω–æ–≤–Ω—ã–µ –º–æ–¥—É–ª–∏ Passport.
*   `passport-jwt`, `@types/passport-jwt`: –°—Ç—Ä–∞—Ç–µ–≥–∏—è –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å JWT.
*   `@nestjs/jwt`, `jsonwebtoken`: –ë–∏–±–ª–∏–æ—Ç–µ–∫–∏ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ JWT.
*   `cookie-parser`, `@types/cookie-parser`: Middleware –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ cookie –∏–∑ –∑–∞–ø—Ä–æ—Å–æ–≤.

### **–®–∞–≥ 2: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è (`.env`)**

–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å —Å–µ–∫—Ä–µ—Ç–æ–≤. –î–æ–±–∞–≤—å —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á –¥–ª—è JWT –≤ —Ñ–∞–π–ª `.env`.

```env
# .env
JWT_SECRET=YOUR_SUPER_SECRET_KEY_THAT_IS_VERY_LONG_AND_COMPLEX
JWT_EXPIRATION_TIME=3600s
```
> **–í–∞–∂–Ω–æ**: `JWT_SECRET` –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –¥–ª–∏–Ω–Ω–æ–π, —Å–ª–æ–∂–Ω–æ–π –∏ —Å–ª—É—á–∞–π–Ω–æ–π —Å—Ç—Ä–æ–∫–æ–π. –ù–∏–∫–æ–≥–¥–∞ –Ω–µ —Ö—Ä–∞–Ω–∏ –µ–≥–æ –≤ –∫–æ–¥–µ!

### **–®–∞- 3: –ì–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª (`main.ts`)**

–ù–∞–º –Ω—É–∂–Ω–æ –Ω–∞—É—á–∏—Ç—å –Ω–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞—Ç—å —Å `cookie-parser`.

```typescript
// src/main.ts

import { NestFactory } from '@nestjs/core';
import { AppModule } from './app.module';
import * as cookieParser from 'cookie-parser'; // –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º cookie-parser

async function bootstrap() {
  const app = await NestFactory.create(AppModule);

  // üëá –í–æ—Ç —ç—Ç–∞ —Å—Ç—Ä–æ—á–∫–∞
  // –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º middleware –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ cookie.
  // –¢–µ–ø–µ—Ä—å –≤ –ª—é–±–æ–º –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–µ –º—ã —Å–º–æ–∂–µ–º –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ `req.cookies`.
  app.use(cookieParser());

  await app.listen(3000);
}
bootstrap();
```

### **–®–∞–≥ 4: –ú–æ–¥—É–ª—å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (`auth.module.ts`)**

–°–æ–∑–¥–∞–¥–∏–º –º–æ–¥—É–ª—å, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –≤—Å—é –ª–æ–≥–∏–∫—É –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏.

```bash
nest g module auth
nest g service auth
nest g controller auth
```

–¢–µ–ø–µ—Ä—å –Ω–∞—Å—Ç—Ä–æ–∏–º `auth.module.ts`.

```typescript
// src/auth/auth.module.ts

import { Module } from '@nestjs/common';
import { AuthService } from './auth.service';
import { AuthController } from './auth.controller';
import { PassportModule } from '@nestjs/passport';
import { JwtModule } from '@nestjs/jwt';
import { ConfigModule, ConfigService } from '@nestjs/config';
import { JwtStrategy } from './jwt.strategy';
// –ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç—Å—è, —á—Ç–æ —É –≤–∞—Å –µ—Å—Ç—å –º–æ–¥—É–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
import { UsersModule } from '../users/users.module';

@Module({
  // `imports` - –∑–¥–µ—Å—å –º—ã –ø–æ–¥–∫–ª—é—á–∞–µ–º –¥—Ä—É–≥–∏–µ –º–æ–¥—É–ª–∏, –∫–æ—Ç–æ—Ä—ã–µ –Ω–∞–º –ø–æ–Ω–∞–¥–æ–±—è—Ç—Å—è.
  imports: [
    // –ü–æ–¥–∫–ª—é—á–∞–µ–º –º–æ–¥—É–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, —á—Ç–æ–±—ã —Å–µ—Ä–≤–∏—Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –º–æ–≥ –∏—Ö –Ω–∞—Ö–æ–¥–∏—Ç—å.
    UsersModule,

    // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º Passport.js. `defaultStrategy: 'jwt'` –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –µ—Å–ª–∏ –º—ã
    // –≥–¥–µ-—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º –≥–≤–∞—Ä–¥ `@UseGuards(AuthGuard())` –±–µ–∑ —É–∫–∞–∑–∞–Ω–∏—è —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏,
    // –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è JWT-—Å—Ç—Ä–∞—Ç–µ–≥–∏—è.
    PassportModule.register({ defaultStrategy: 'jwt' }),

    // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –º–æ–¥—É–ª—å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å JWT.
    JwtModule.registerAsync({
      // `registerAsync` –ø–æ–∑–≤–æ–ª—è–µ—Ç –Ω–∞–º –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ —Å–∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–æ–≤–∞—Ç—å –º–æ–¥—É–ª—å,
      // –Ω–∞–ø—Ä–∏–º–µ—Ä, —á—Ç–æ–±—ã –≤–∑—è—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–∑ `.env` —Ñ–∞–π–ª–∞.
      imports: [ConfigModule], // –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º ConfigModule, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ ConfigService.
      inject: [ConfigService], // –í–Ω–µ–¥—Ä—è–µ–º ConfigService –≤ –Ω–∞—à—É —Ñ–∞–±—Ä–∏–∫—É.
      useFactory: async (configService: ConfigService) => ({
        // `secret` - —ç—Ç–æ –Ω–∞—à —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á –¥–ª—è –ø–æ–¥–ø–∏—Å–∏ —Ç–æ–∫–µ–Ω–æ–≤.
        // –ú—ã –±–µ—Ä–µ–º –µ–≥–æ –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.
        secret: configService.get<string>('JWT_SECRET'),
        // `signOptions` - –æ–ø—Ü–∏–∏ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç–æ–∫–µ–Ω–∞.
        signOptions: {
          // `expiresIn` - –≤—Ä–µ–º—è –∂–∏–∑–Ω–∏ —Ç–æ–∫–µ–Ω–∞. –ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ —Ç–æ–∫–µ–Ω —Å—Ç–∞–Ω–µ—Ç –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–º.
          expiresIn: configService.get<string>('JWT_EXPIRATION_TIME'),
        },
      }),
    }),
  ],
  // `providers` - —ç—Ç–æ —Å–µ—Ä–≤–∏—Å—ã –∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥—É—Ç –¥–æ—Å—Ç—É–ø–Ω—ã –≤–Ω—É—Ç—Ä–∏ —ç—Ç–æ–≥–æ –º–æ–¥—É–ª—è.
  providers: [AuthService, JwtStrategy],
  // `controllers` - –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã, –∫–æ—Ç–æ—Ä—ã–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç HTTP-–∑–∞–ø—Ä–æ—Å—ã.
  controllers: [AuthController],
})
export class AuthModule {}
```

### **–®–∞–≥ 5: JWT –°—Ç—Ä–∞—Ç–µ–≥–∏—è (`jwt.strategy.ts`)**

–≠—Ç–æ —Å–µ—Ä–¥—Ü–µ –Ω–∞—à–µ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏. –°—Ç—Ä–∞—Ç–µ–≥–∏—è –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –æ–¥–∏–Ω –≤–æ–ø—Ä–æ—Å: "–ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –≤—Ö–æ–¥—è—â–∏–π –∑–∞–ø—Ä–æ—Å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω?".

–°–æ–∑–¥–∞–π —Ñ–∞–π–ª `src/auth/jwt.strategy.ts`.

```typescript
// src/auth/jwt.strategy.ts

import { Injectable, UnauthorizedException } from '@nestjs/common';
import { PassportStrategy } from '@nestjs/passport';
import { Strategy, ExtractJwt } from 'passport-jwt';
import { ConfigService } from '@nestjs/config';
import { Request } from 'express';
import { UsersService } from '../users/users.service'; // –ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º, —á—Ç–æ –µ—Å—Ç—å —Å–µ—Ä–≤–∏—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

// `@Injectable()` - –¥–µ–ª–∞–µ—Ç –∫–ª–∞—Å—Å –¥–æ—Å—Ç—É–ø–Ω—ã–º –¥–ª—è Dependency Injection –≤ NestJS.
@Injectable()
export class JwtStrategy extends PassportStrategy(Strategy) {
  // `constructor` - –∑–¥–µ—Å—å –º—ã –≤–Ω–µ–¥—Ä—è–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–Ω–∞–¥–æ–±—è—Ç—Å—è —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏.
  constructor(
    private readonly configService: ConfigService,
    private readonly usersService: UsersService,
  ) {
    // `super()` - –≤—ã–∑—ã–≤–∞–µ–º –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ –∫–ª–∞—Å—Å–∞ `PassportStrategy`.
    super({
      // `jwtFromRequest` - —ç—Ç–æ —Ñ—É–Ω–∫—Ü–∏—è, –∫–æ—Ç–æ—Ä–∞—è –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç, –∫–∞–∫ –∏–∑–≤–ª–µ—á—å JWT –∏–∑ –∑–∞–ø—Ä–æ—Å–∞.
      // –ú—ã –Ω–∞–ø–∏—à–µ–º —Å–≤–æ—é –ª–æ–≥–∏–∫—É, —á—Ç–æ–±—ã –∏–∑–≤–ª–µ–∫–∞—Ç—å —Ç–æ–∫–µ–Ω –∏–∑ cookie.
      jwtFromRequest: ExtractJwt.fromExtractors([
        // –ù–∞—à–∞ –∫–∞—Å—Ç–æ–º–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è-—ç–∫—Å—Ç—Ä–∞–∫—Ç–æ—Ä.
        (request: Request) => {
          // –ú—ã –æ–∂–∏–¥–∞–µ–º, —á—Ç–æ —Ç–æ–∫–µ–Ω –±—É–¥–µ—Ç –≤ cookie —Å –∏–º–µ–Ω–µ–º `access_token`.
          const token = request.cookies?.access_token;
          // –ï—Å–ª–∏ —Ç–æ–∫–µ–Ω–∞ –Ω–µ—Ç, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º null, –∏ Passport –ø–æ–π–º–µ—Ç, —á—Ç–æ –∑–∞–ø—Ä–æ—Å –Ω–µ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω.
          if (!token) {
            return null;
          }
          // –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Ç–æ–∫–µ–Ω –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–π –ø—Ä–æ–≤–µ—Ä–∫–∏.
          return token;
        },
      ]),
      // `ignoreExpiration: false` - Passport –±—É–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è—Ç—å, –Ω–µ –∏—Å—Ç–µ–∫ –ª–∏ —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è —Ç–æ–∫–µ–Ω–∞.
      // –ï—Å–ª–∏ —Ç–æ–∫–µ–Ω –∏—Å—Ç–µ–∫, –∑–∞–ø—Ä–æ—Å –±—É–¥–µ—Ç –æ—Ç–∫–ª–æ–Ω–µ–Ω —Å –æ—à–∏–±–∫–æ–π 401.
      ignoreExpiration: false,
      // `secretOrKey` - —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á, –∫–æ—Ç–æ—Ä—ã–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ø–∏—Å–∏ —Ç–æ–∫–µ–Ω–∞.
      // –û–Ω –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Ç–∞–∫–∏–º –∂–µ, –∫–∞–∫ –∏ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ç–æ–∫–µ–Ω–∞.
      secretOrKey: configService.get<string>('JWT_SECRET'),
    });
  }

  // `validate` - —ç—Ç–æ –≥–ª–∞–≤–Ω—ã–π –º–µ—Ç–æ–¥ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏. –û–Ω –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è Passport'–æ–º —Ç–æ–ª—å–∫–æ –ü–û–°–õ–ï —Ç–æ–≥–æ,
  // –∫–∞–∫ —Ç–æ–∫–µ–Ω –±—ã–ª —É—Å–ø–µ—à–Ω–æ –∏–∑–≤–ª–µ—á–µ–Ω –∏ –µ–≥–æ –ø–æ–¥–ø–∏—Å—å –∏ —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è –±—ã–ª–∏ –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã.
  // `payload` - —ç—Ç–æ —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ JWT.
  async validate(payload: { sub: number; email: string }) {
    // `sub` (subject) - —ç—Ç–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –ø–æ–ª–µ –≤ JWT, –º—ã –±—É–¥–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ–≥–æ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
    const user = await this.usersService.findOne(payload.sub);

    // –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ç–∞–∫–∏–º ID –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö...
    if (!user) {
      // ...–≤—ã–±—Ä–∞—Å—ã–≤–∞–µ–º –æ—à–∏–±–∫—É. –ó–∞–ø—Ä–æ—Å –±—É–¥–µ—Ç –æ—Ç–∫–ª–æ–Ω–µ–Ω.
      throw new UnauthorizedException('User not found');
    }

    // –ï—Å–ª–∏ –≤—Å–µ —Ö–æ—Ä–æ—à–æ, –º—ã –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –æ–±—ä–µ–∫—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
    // NestJS –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏–∫—Ä–µ–ø–∏—Ç —ç—Ç–æ—Ç –æ–±—ä–µ–∫—Ç –∫ –∑–∞–ø—Ä–æ—Å—É –∫–∞–∫ `req.user`.
    // –¢–µ–ø–µ—Ä—å –≤ –ª—é–±–æ–º –∑–∞—â–∏—â–µ–Ω–Ω–æ–º –º–∞—Ä—à—Ä—É—Ç–µ –º—ã —Å–º–æ–∂–µ–º –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ —Ç–µ–∫—É—â–µ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é.
    // –í–∞–∂–Ω–æ: –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–π—Ç–µ –ø–∞—Ä–æ–ª—å –∏–ª–∏ –¥—Ä—É–≥–∏–µ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ!
    const { password, ...result } = user;
    return result;
  }
}
```

### **–®–∞–≥ 6: –°–µ—Ä–≤–∏—Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (`auth.service.ts`)**

–ó–¥–µ—Å—å –±—É–¥–µ—Ç –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞: –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞.

```typescript
// src/auth/auth.service.ts

import { Injectable, UnauthorizedException } from '@nestjs/common';
import { JwtService } from '@nestjs/jwt';
import { UsersService } from '../users/users.service';
import * as bcrypt from 'bcrypt'; // –î–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è –ø–∞—Ä–æ–ª–µ–π

@Injectable()
export class AuthService {
  constructor(
    private usersService: UsersService,
    private jwtService: JwtService,
  ) {}

  // `validateUser` - –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏ –≤–µ—Ä–µ–Ω –ª–∏ –ø–∞—Ä–æ–ª—å.
  async validateUser(email: string, pass: string): Promise<any> {
    // –ù–∞—Ö–æ–¥–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ email.
    const user = await this.usersService.findByEmail(email);

    // –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–π–¥–µ–Ω –∏ –ø–∞—Ä–æ–ª—å —Å–æ–≤–ø–∞–¥–∞–µ—Ç...
    // `bcrypt.compare` —Å—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç –æ–±—ã—á–Ω—ã–π –ø–∞—Ä–æ–ª—å —Å –∑–∞—Ö—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –≤ –±–∞–∑–µ.
    if (user && (await bcrypt.compare(pass, user.password))) {
      // ...–≤–æ–∑–≤—Ä–∞—â–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –±–µ–∑ –ø–∞—Ä–æ–ª—è.
      const { password, ...result } = user;
      return result;
    }
    // –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ —Ç–∞–∫, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º null.
    return null;
  }

  // `login` - —Å–æ–∑–¥–∞–µ—Ç –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç JWT –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
  async login(user: any) {
    // `payload` - —ç—Ç–æ –¥–∞–Ω–Ω—ã–µ, –∫–æ—Ç–æ—Ä—ã–µ –º—ã —Ö–æ—Ç–∏–º –∑–∞–∫–æ–¥–∏—Ä–æ–≤–∞—Ç—å –≤ —Ç–æ–∫–µ–Ω.
    const payload = { email: user.email, sub: user.id }; // `sub` - —ç—Ç–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –∏–º—è –¥–ª—è ID.

    // `this.jwtService.sign` —Å–æ–∑–¥–∞–µ—Ç –∏ –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç —Ç–æ–∫–µ–Ω.
    // –û–Ω –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á –∏ –æ–ø—Ü–∏–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `expiresIn`), –∫–æ—Ç–æ—Ä—ã–µ –º—ã –Ω–∞—Å—Ç—Ä–æ–∏–ª–∏ –≤ `auth.module.ts`.
    return {
      access_token: this.jwtService.sign(payload),
    };
  }
}
```

### **–®–∞–≥ 7: –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (`auth.controller.ts`)**

–≠—Ç–æ –Ω–∞—à–∏ "–≤–æ—Ä–æ—Ç–∞" –≤ –º–∏—Ä –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏. –ó–¥–µ—Å—å –±—É–¥—É—Ç —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –¥–ª—è –≤—Ö–æ–¥–∞, –≤—ã—Ö–æ–¥–∞ –∏ –ø–æ–ª—É—á–µ–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è.

```typescript
// src/auth/auth.controller.ts

import { Controller, Post, Body, UseGuards, Get, Req, Res } from '@nestjs/common';
import { AuthService } from './auth.service';
import { AuthGuard } from '@nestjs/passport';
import { Request, Response } from 'express';

@Controller('auth')
export class AuthController {
  constructor(private authService: AuthService) {}

  // `POST /auth/login` - —ç–Ω–¥–ø–æ–∏–Ω—Ç –¥–ª—è –≤—Ö–æ–¥–∞ –≤ —Å–∏—Å—Ç–µ–º—É.
  @Post('login')
  async login(@Body() loginDto: any, @Res({ passthrough: true }) response: Response) {
    // `validateUser` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ª–æ–≥–∏–Ω –∏ –ø–∞—Ä–æ–ª—å.
    const user = await this.authService.validateUser(loginDto.email, loginDto.password);
    // –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω –∏–ª–∏ –ø–∞—Ä–æ–ª—å –Ω–µ–≤–µ—Ä–Ω—ã–π, –≤—ã–±—Ä–∞—Å—ã–≤–∞–µ–º –æ—à–∏–±–∫—É.
    if (!user) {
      throw new UnauthorizedException('Invalid credentials');
    }
    // `login` —Å–æ–∑–¥–∞–µ—Ç JWT.
    const { access_token } = await this.authService.login(user);

    // `response.cookie` - —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º cookie.
    response.cookie('access_token', access_token, {
      // `httpOnly: true` - cookie –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è JavaScript –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ. –ó–∞—â–∏—Ç–∞ –æ—Ç XSS.
      httpOnly: true,
      // `secure: true` - cookie –±—É–¥–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å—Å—è —Ç–æ–ª—å–∫–æ –ø–æ HTTPS. –í —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –º–æ–∂–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤ `false`.
      secure: process.env.NODE_ENV === 'production',
      // `sameSite: 'strict'` - –∑–∞—â–∏—Ç–∞ –æ—Ç CSRF-–∞—Ç–∞–∫. Cookie –±—É–¥–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å—Å—è —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –∑–∞–ø—Ä–æ—Å –∏–¥–µ—Ç —Å —Ç–æ–≥–æ –∂–µ —Å–∞–π—Ç–∞.
      sameSite: 'strict',
      // `expires` - –º–æ–∂–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Ä–µ–º—è –∂–∏–∑–Ω–∏ cookie.
      // expires: new Date(Date.now() + 3600 * 1000), // –ù–∞–ø—Ä–∏–º–µ—Ä, 1 —á–∞—Å
    });

    // –í–æ–∑–≤—Ä–∞—â–∞–µ–º —É—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç.
    return { message: 'Logged in successfully' };
  }

  // `GET /auth/profile` - –∑–∞—â–∏—â–µ–Ω–Ω—ã–π –º–∞—Ä—à—Ä—É—Ç –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –æ —Ç–µ–∫—É—â–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ.
  // `@UseGuards(AuthGuard('jwt'))` - —ç—Ç–æ "—Å—Ç—Ä–∞–∂–Ω–∏–∫". –û–Ω –∑–∞–ø—É—Å–∫–∞–µ—Ç –Ω–∞—à—É JWT-—Å—Ç—Ä–∞—Ç–µ–≥–∏—é.
  // –ï—Å–ª–∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è —É—Å–ø–µ—à–Ω–æ –æ—Ç—Ä–∞–±–æ—Ç–∞–µ—Ç (—Ç–æ–∫–µ–Ω –≤–∞–ª–∏–¥–µ–Ω), —Ç–æ –º–µ—Ç–æ–¥ –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω.
  // –ï—Å–ª–∏ –Ω–µ—Ç - –≤–µ—Ä–Ω–µ—Ç—Å—è –æ—à–∏–±–∫–∞ 401 Unauthorized.
  @UseGuards(AuthGuard('jwt'))
  @Get('profile')
  getProfile(@Req() req: Request) {
    // –ë–ª–∞–≥–æ–¥–∞—Ä—è `validate` –≤ –Ω–∞—à–µ–π —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏, –æ–±—ä–µ–∫—Ç `req.user` —Ç–µ–ø–µ—Ä—å —Å–æ–¥–µ—Ä–∂–∏—Ç
    // –¥–∞–Ω–Ω—ã–µ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ, –∫–æ—Ç–æ—Ä—ã–µ –º—ã –≤–µ—Ä–Ω—É–ª–∏.
    return req.user;
  }

  // `POST /auth/logout` - —ç–Ω–¥–ø–æ–∏–Ω—Ç –¥–ª—è –≤—ã—Ö–æ–¥–∞ –∏–∑ —Å–∏—Å—Ç–µ–º—ã.
  @Post('logout')
  logout(@Res({ passthrough: true }) response: Response) {
    // `response.clearCookie` - —É–¥–∞–ª—è–µ–º cookie, —Ç–µ–º —Å–∞–º—ã–º "—Ä–∞–∑–ª–æ–≥–∏–Ω–∏–≤–∞—è" –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
    response.clearCookie('access_token');
    return { message: 'Logged out successfully' };
  }
}
```

### **–®–∞–≥ 8: –ó–∞—â–∏—Ç–∞ –¥—Ä—É–≥–∏—Ö –º–∞—Ä—à—Ä—É—Ç–æ–≤**

–¢–µ–ø–µ—Ä—å –∑–∞—â–∏—Ç–∏—Ç—å –ª—é–±–æ–π –º–∞—Ä—à—Ä—É—Ç –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –æ—á–µ–Ω—å –ø—Ä–æ—Å—Ç–æ. –ü—Ä–æ—Å—Ç–æ –¥–æ–±–∞–≤—å –≥–≤–∞—Ä–¥!

```typescript
// –ù–∞–ø—Ä–∏–º–µ—Ä, –≤ `src/todos/todos.controller.ts`

import { Controller, Get, UseGuards } from '@nestjs/common';
import { AuthGuard } from '@nestjs/passport';

@Controller('todos')
export class TodosController {
  // üëá –í–æ—Ç –∏ –≤—Å—è –º–∞–≥–∏—è!
  // –≠—Ç–æ—Ç –≥–≤–∞—Ä–¥ –Ω–µ –¥–∞—Å—Ç –Ω–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ —ç–Ω–¥–ø–æ–∏–Ω—Ç—É.
  @UseGuards(AuthGuard('jwt'))
  @Get()
  findAll() {
    return [{ id: 1, title: '–°–¥–µ–ª–∞—Ç—å –∫—Ä—É—Ç—É—é –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é' }];
  }
}
```

---

## üîê **–ß–∞—Å—Ç—å 3: –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –ª—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏**

–ú—ã —É–∂–µ –≤–Ω–µ–¥—Ä–∏–ª–∏ –º–Ω–æ–≥–æ —Ö–æ—Ä–æ—à–∏—Ö –ø—Ä–∞–∫—Ç–∏–∫, –Ω–æ –¥–∞–≤–∞–π –∏—Ö –∑–∞–∫—Ä–µ–ø–∏–º.

1.  **`httpOnly` Cookies**: –ú—ã —ç—Ç–æ —Å–¥–µ–ª–∞–ª–∏. –≠—Ç–æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–æ –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç XSS.
2.  **`secure` –∏ `sameSite`**: –ú—ã —ç—Ç–æ —Å–¥–µ–ª–∞–ª–∏. `secure: true` –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ –∏ `sameSite: 'strict'` (–∏–ª–∏ `'lax'`) ‚Äî –º–æ—â–Ω–∞—è –∑–∞—â–∏—Ç–∞ –æ—Ç CSRF.
3.  **–ö–æ—Ä–æ—Ç–∫–æ–µ –≤—Ä–µ–º—è –∂–∏–∑–Ω–∏ —Ç–æ–∫–µ–Ω–∞**: –ù–∞—à `access_token` –∂–∏–≤–µ—Ç –Ω–µ–¥–æ–ª–≥–æ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 1 —á–∞—Å). –≠—Ç–æ —É–º–µ–Ω—å—à–∞–µ—Ç –æ–∫–Ω–æ —É—è–∑–≤–∏–º–æ—Å—Ç–∏, –µ—Å–ª–∏ —Ç–æ–∫–µ–Ω –≤—Å–µ –∂–µ –±—É–¥–µ—Ç —Å–∫–æ–º–ø—Ä–æ–º–µ—Ç–∏—Ä–æ–≤–∞–Ω.
4.  **Refresh Tokens (–ø—Ä–æ–¥–≤–∏–Ω—É—Ç–∞—è —Ç–µ–º–∞)**: –î–ª—è —É–ª—É—á—à–µ–Ω–∏—è UX –º–æ–∂–Ω–æ –≤–Ω–µ–¥—Ä–∏—Ç—å Refresh-—Ç–æ–∫–µ–Ω—ã. –≠—Ç–æ –¥–æ–ª–≥–æ–∂–∏–≤—É—â–∏–µ —Ç–æ–∫–µ–Ω—ã, –∫–æ—Ç–æ—Ä—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ `access_token`, –∫–æ–≥–¥–∞ —Å—Ç–∞—Ä—ã–π –∏—Å—Ç–µ–∫–∞–µ—Ç. –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –æ—Å—Ç–∞–≤–∞—Ç—å—Å—è –≤ —Å–∏—Å—Ç–µ–º–µ –Ω–µ–¥–µ–ª—è–º–∏, –Ω–µ –≤–≤–æ–¥—è –ø–∞—Ä–æ–ª—å –∑–∞–Ω–æ–≤–æ, –ø—Ä–∏ —ç—Ç–æ–º —Å–æ—Ö—Ä–∞–Ω—è—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∫–æ—Ä–æ—Ç–∫–æ–∂–∏–≤—É—â–∏—Ö —Ç–æ–∫–µ–Ω–æ–≤ –¥–æ—Å—Ç—É–ø–∞.
5.  **–ù–∏–∫–æ–≥–¥–∞ –Ω–µ —Ö—Ä–∞–Ω–∏—Ç–µ –ø–∞—Ä–æ–ª–∏ –≤ –æ—Ç–∫—Ä—ã—Ç–æ–º –≤–∏–¥–µ**: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `bcrypt` –¥–ª—è —Ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –ø–∞—Ä–æ–ª–µ–π –ø–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –≤ –±–∞–∑—É. –ú—ã —ç—Ç–æ —É—á–ª–∏ –≤ `auth.service`.

---

## ‚ú® **–ó–∞–∫–ª—é—á–µ–Ω–∏–µ**

–ü–æ–∑–¥—Ä–∞–≤–ª—è—é! –¢—ã —Ç–æ–ª—å–∫–æ —á—Ç–æ –ø—Ä–æ—à–µ–ª –ø—É—Ç—å –æ—Ç –Ω–æ–≤–∏—á–∫–∞ –¥–æ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞ –≤ –æ–±–ª–∞—Å—Ç–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –≤ NestJS. –¢—ã –Ω–µ –ø—Ä–æ—Å—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–ª —Å–∏—Å—Ç–µ–º—É, –∞ –ø–æ–Ω—è–ª, **–ø–æ—á–µ–º—É** –∫–∞–∂–¥—ã–π —ç–ª–µ–º–µ–Ω—Ç –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –Ω–∞ —Å–≤–æ–µ–º –º–µ—Å—Ç–µ.

-   –¢—ã –∑–Ω–∞–µ—à—å, –∫–∞–∫ **Passport** —É–ø—Ä–æ—â–∞–µ—Ç –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é —Å –ø–æ–º–æ—â—å—é **—Å—Ç—Ä–∞—Ç–µ–≥–∏–π**.
-   –¢—ã –ø–æ–Ω–∏–º–∞–µ—à—å, –ø–æ—á–µ–º—É **JWT** ‚Äî –æ—Ç–ª–∏—á–Ω—ã–π –≤—ã–±–æ—Ä –¥–ª—è **stateless** API.
-   –¢—ã –æ—Å–æ–∑–Ω–∞–µ—à—å, —á—Ç–æ **`httpOnly` cookies** ‚Äî —ç—Ç–æ **must-have** –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.

–¢–µ–ø–µ—Ä—å —Ç—ã –º–æ–∂–µ—à—å —É–≤–µ—Ä–µ–Ω–Ω–æ —Å—Ç—Ä–æ–∏—Ç—å –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ, –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º—ã–µ –∏ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–µ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. –≠—Ç–∞ –±–∞–∑–∞ –∑–Ω–∞–Ω–∏–π ‚Äî —Ç–≤–æ–π –Ω–∞–¥–µ–∂–Ω—ã–π —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ —Ä–æ—Å—Ç–∞. –£–¥–∞—á–∏ –≤ —Ç–≤–æ–∏—Ö –ø—Ä–æ–µ–∫—Ç–∞—Ö!
